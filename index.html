<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Flappy Bird Clone</title>
<style>
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0;
    background: #70c5ce;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }
  canvas {
    background: #70c5ce;
    display: block;
    border: 2px solid #000;
    border-radius: 10px;
  }
  #menu {
    position: absolute;
    top: 20%;
    left: 50%;
    transform: translateX(-50%);
    text-align: center;
    color: white;
    user-select: none;
  }
  #menu h1 {
    font-size: 48px;
    margin-bottom: 10px;
    text-shadow: 2px 2px 4px #000;
  }
  #menu button {
    font-size: 24px;
    padding: 10px 30px;
    background: #ff0;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    box-shadow: 0 3px #cc0;
    transition: background 0.3s;
  }
  #menu button:hover {
    background: #ffc;
  }
  #score {
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 36px;
    font-weight: bold;
    color: white;
    text-shadow: 2px 2px 5px #000;
    user-select: none;
  }
  #gameover {
    position: absolute;
    top: 40%;
    left: 50%;
    transform: translateX(-50%);
    color: white;
    font-size: 48px;
    text-shadow: 3px 3px 7px #000;
    user-select: none;
    display: none;
  }
</style>
</head>
<body>

<div id="menu">
  <h1>Flappy Bird</h1>
  <button id="startBtn">Start Game</button>
  <p style="margin-top:20px; font-size: 18px;">Press Spacebar or Click to flap</p>
</div>

<div id="score" style="display:none;">0</div>
<div id="gameover">Game Over<br><button id="restartBtn">Restart</button></div>

<canvas id="gameCanvas" width="400" height="600"></canvas>

<script>
// Setup canvas
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

const menu = document.getElementById('menu');
const startBtn = document.getElementById('startBtn');
const scoreDisplay = document.getElementById('score');
const gameOverDisplay = document.getElementById('gameover');
const restartBtn = document.getElementById('restartBtn');

const WIDTH = canvas.width;
const HEIGHT = canvas.height;

// Sounds
const flapSound = new Audio('https://freesound.org/data/previews/341/341695_62436-lq.mp3');
const scoreSound = new Audio('https://freesound.org/data/previews/186/186942_1505074-lq.mp3');
const hitSound = new Audio('https://freesound.org/data/previews/256/256113_4486188-lq.mp3');

// Bird properties
const bird = {
  x: 80,
  y: HEIGHT / 2,
  width: 34,
  height: 24,
  gravity: 0.6,
  lift: -10,
  velocity: 0,
  rotation: 0,
  draw() {
    ctx.save();
    ctx.translate(this.x, this.y);
    ctx.rotate(this.rotation);
    ctx.fillStyle = 'yellow';
    ctx.strokeStyle = 'orange';
    ctx.lineWidth = 3;
    ctx.beginPath();
    // Draw simple bird shape: circle with beak
    ctx.ellipse(0, 0, this.width / 2, this.height / 2, 0, 0, Math.PI * 2);
    ctx.fill();
    ctx.stroke();

    // Beak
    ctx.fillStyle = 'orange';
    ctx.beginPath();
    ctx.moveTo(this.width / 2 - 5, 0);
    ctx.lineTo(this.width / 2 + 10, -5);
    ctx.lineTo(this.width / 2 + 10, 5);
    ctx.closePath();
    ctx.fill();
    ctx.restore();
  },
  update() {
    this.velocity += this.gravity;
    this.velocity *= 0.9; // air resistance
    this.y += this.velocity;

    // Rotate bird depending on velocity
    this.rotation = Math.min(Math.max(this.velocity / 15, -0.5), 0.5);

    // Prevent bird from going out of canvas
    if (this.y + this.height / 2 >= HEIGHT) {
      this.y = HEIGHT - this.height / 2;
      this.velocity = 0;
      gameOver();
    }
    if (this.y - this.height / 2 <= 0) {
      this.y = this.height / 2;
      this.velocity = 0;
    }
  },
  flap() {
    this.velocity = this.lift;
    flapSound.currentTime = 0;
    flapSound.play();
  }
};

// Pipes properties
const pipeWidth = 60;
const pipeGap = 150;
const pipeSpeed = 3;
let pipes = [];

function createPipe() {
  // Random pipe height between 50 and HEIGHT - pipeGap - 50
  const topHeight = Math.floor(Math.random() * (HEIGHT - pipeGap - 100)) + 50;
  pipes.push({
    x: WIDTH,
    top: topHeight,
    bottom: HEIGHT - topHeight - pipeGap,
    passed: false,
  });
}

function drawPipes() {
  ctx.fillStyle = '#228B22'; // forest green
  ctx.strokeStyle = '#145214';
  ctx.lineWidth = 3;

  pipes.forEach(pipe => {
    // Top pipe
    ctx.beginPath();
    ctx.rect(pipe.x, 0, pipeWidth, pipe.top);
    ctx.fill();
    ctx.stroke();

    // Bottom pipe
    ctx.beginPath();
    ctx.rect(pipe.x, HEIGHT - pipe.bottom, pipeWidth, pipe.bottom);
    ctx.fill();
    ctx.stroke();
  });
}

function updatePipes() {
  pipes.forEach(pipe => {
    pipe.x -= pipeSpeed;
  });

  // Remove offscreen pipes
  if (pipes.length && pipes[0].x + pipeWidth < 0) {
    pipes.shift();
  }
}

// Collision detection between bird and pipes
function checkCollision() {
  for (let pipe of pipes) {
    if (
      bird.x + bird.width / 2 > pipe.x &&
      bird.x - bird.width / 2 < pipe.x + pipeWidth
    ) {
      // Check if bird is within pipe gap vertically
      if (
        bird.y - bird.height / 2 < pipe.top ||
        bird.y + bird.height / 2 > HEIGHT - pipe.bottom
      ) {
        gameOver();
      }
    }
  }
}

// Score
let score = 0;

function updateScore() {
  pipes.forEach(pipe => {
    if (!pipe.passed && pipe.x + pipeWidth < bird.x - bird.width / 2) {
      score++;
      pipe.passed = true;
      scoreSound.currentTime = 0;
      scoreSound.play();
      scoreDisplay.textContent = score;
    }
  });
}

// Game loop variables
let animationId;
let gameRunning = false;

// Game loop
function gameLoop() {
  ctx.clearRect(0, 0, WIDTH, HEIGHT);

  bird.update();
  bird.draw();

  drawPipes();
  updatePipes();

  checkCollision();
  updateScore();

  animationId = requestAnimationFrame(gameLoop);
}

// Game control functions
function startGame() {
  menu.style.display = 'none';
  scoreDisplay.style.display = 'block';
  gameOverDisplay.style.display = 'none';
  score = 0;
  scoreDisplay.textContent = score;
  pipes = [];
  bird.y = HEIGHT / 2;
  bird.velocity = 0;
  gameRunning = true;

  // Start with 2 pipes to begin
  createPipe();
  createPipe();

  if(animationId) cancelAnimationFrame(animationId);
  gameLoop();
}

function gameOver() {
  if (!gameRunning) return;
  gameRunning = false;
  hitSound.play();
  cancelAnimationFrame(animationId);
  gameOverDisplay.style.display = 'block';
  scoreDisplay.style.display = 'none';
}

startBtn.addEventListener('click', startGame);
restartBtn.addEventListener('click', startGame);

document.addEventListener('keydown', e => {
  if (e.code === 'Space' || e.code === 'ArrowUp') {
    e.preventDefault();
    if (gameRunning) {
      bird.flap();
    }
  }
});

document.addEventListener('click', () => {
  if (gameRunning) {
    bird.flap();
  }
});

// Pipe generation interval
let pipeInterval;

function startPipeInterval() {
  if (pipeInterval) clearInterval(pipeInterval);
  pipeInterval = setInterval(() => {
    if (gameRunning) createPipe();
  }, 1500);
}

startBtn.addEventListener('click', () => {
  startPipeInterval();
});

restartBtn.addEventListener('click', () => {
  startPipeInterval();
});

gameOverDisplay.querySelector('button').addEventListener('click', () => {
  startPipeInterval();
});
</script>
</body>
</html>
