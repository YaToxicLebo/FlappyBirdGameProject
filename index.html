<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Flappy Deluxe</title>
  <style>
    :root{
      --sky:#8fd3fe;--sky2:#bde9ff;--ground:#6fcf97;--pipe:#2b9a77;--pipe-dark:#227a5f;--accent:#ffd166;--muted:#64748b;--glass:rgba(255,255,255,0.25);
    }
    *{box-sizing:border-box;font-family:Poppins,Inter,ui-sans-serif}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--sky),var(--sky2));}
    .center{display:flex;align-items:center;justify-content:center;height:100%;}
    canvas{display:block;margin:auto;background:transparent}
    #menu{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;flex-direction:column;background:linear-gradient(180deg,var(--sky),var(--sky2));z-index:10;transition:opacity .6s;}
    #menu.hidden{opacity:0;pointer-events:none;}
    #menu h1{font-size:3rem;color:#fff;text-shadow:0 3px 6px rgba(0,0,0,0.3);animation:float 3s ease-in-out infinite;}
    #menu button{margin-top:20px;padding:12px 30px;border:none;border-radius:12px;background:linear-gradient(180deg,var(--accent),#ffb84d);color:#043;font-weight:700;font-size:1rem;cursor:pointer;box-shadow:0 6px 18px rgba(0,0,0,0.25);transition:transform .2s;}
    #menu button:hover{transform:scale(1.05);}
    @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
  </style>
</head>
<body>
  <div class="center">
    <canvas id="game" width="800" height="500"></canvas>
    <div id="menu">
      <h1>Flappy Deluxe</h1>
      <button id="play">Play</button>
    </div>
  </div>

  <script>
  const canvas=document.getElementById('game');
  const ctx=canvas.getContext('2d');
  const menu=document.getElementById('menu');
  const playBtn=document.getElementById('play');
  let bird,pipes,gravity,frame,running,score,best=0; let intro=true;

  function fit(){canvas.width=window.innerWidth>800?800:window.innerWidth*0.95;canvas.height=window.innerHeight>500?500:window.innerHeight*0.7;}
  window.addEventListener('resize',fit);fit();

  function reset(){
    bird={x:canvas.width/4,y:canvas.height/2,vy:0,r:16,rot:0,hover:0};
    pipes=[];frame=0;score=0;gravity=0.4;running=false;intro=true;
  }

  function spawnPipe(){
    const gap=130;const top=60+Math.random()*(canvas.height-gap-120);
    pipes.push({x:canvas.width,top, gap, passed:false});
  }

  function startGame(){reset();menu.classList.add('hidden');running=true;intro=false;loop();beep(880,0.06);}
  playBtn.onclick=startGame;
  canvas.onclick=()=>{if(intro){startGame()}else if(running){flap()}};
  window.onkeydown=e=>{if(e.code==='Space'){e.preventDefault();if(intro)startGame();else flap();}};

  function flap(){bird.vy=-6;beep(880,0.05);}

  function beep(freq,len){try{const a=new(window.AudioContext||window.webkitAudioContext)();const o=a.createOscillator();const g=a.createGain();o.connect(g);g.connect(a.destination);g.gain.value=0.08;o.frequency.value=freq;o.start();setTimeout(()=>{o.stop();a.close();},len*1000);}catch(e){}}

  function update(){
    frame++;
    if(frame%100===0)spawnPipe();
    if(intro){bird.hover+=0.1;bird.y=canvas.height/2+Math.sin(bird.hover)*10;return;}
    for(let i=pipes.length-1;i>=0;i--){pipes[i].x-=2; if(pipes[i].x<-60)pipes.splice(i,1);} 
    bird.vy+=gravity;bird.y+=bird.vy;bird.rot=Math.max(-0.3,Math.min(1.2,bird.vy*0.05));
    pipes.forEach(p=>{if(!p.passed&&p.x+60<bird.x){p.passed=true;score++;beep(660,0.04);} });
    for(const p of pipes){if(collide(bird,p)){running=false;menu.classList.remove('hidden');menu.querySelector('h1').innerText='Game Over! Score '+score;beep(220,0.2);}}
    if(bird.y+bird.r>canvas.height-24){running=false;menu.classList.remove('hidden');menu.querySelector('h1').innerText='Game Over! Score '+score;beep(220,0.2);}  
  }

  function collide(b,p){if(b.x+b.r>p.x&&b.x-b.r<p.x+60){if(b.y-b.r<p.top||b.y+b.r>p.top+p.gap)return true;}return false;}

  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    const g=ctx.createLinearGradient(0,0,0,canvas.height);g.addColorStop(0,'#9be7ff');g.addColorStop(1,'#bfeaff');ctx.fillStyle=g;ctx.fillRect(0,0,canvas.width,canvas.height);
    for(const p of pipes){ctx.fillStyle='#2b9a77';ctx.fillRect(p.x,0,60,p.top);ctx.fillRect(p.x,p.top+p.gap,60,canvas.height-(p.top+p.gap)-24);}
    ctx.fillStyle='#6fcf97';ctx.fillRect(0,canvas.height-24,canvas.width,24);
    ctx.save();ctx.translate(bird.x,bird.y);ctx.rotate(bird.rot);ctx.fillStyle='#ffd166';ctx.beginPath();ctx.ellipse(0,0,bird.r,bird.r*0.85,0,0,Math.PI*2);ctx.fill();ctx.fillStyle='#111';ctx.beginPath();ctx.arc(-4,-2,3,0,Math.PI*2);ctx.fill();ctx.restore();
    ctx.fillStyle='#fff';ctx.font='bold 20px Poppins';ctx.fillText(score,20,30);
  }

  function loop(){update();draw();if(running)requestAnimationFrame(loop);} 
  reset();loop();
  </script>
</body>
</html>
