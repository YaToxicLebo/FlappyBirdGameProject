<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Flappy Bird Enhanced</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      background: #70c5ce;
      font-family: 'Press Start 2P', cursive, monospace;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      user-select: none;
      overflow: hidden;
    }
    #container {
      position: relative;
      width: 400px;
      height: 600px;
      box-shadow: 0 0 15px rgba(0,0,0,0.6);
      border-radius: 15px;
      overflow: hidden;
      background: #70c5ce;
    }
    canvas {
      display: block;
      background: transparent;
      border-radius: 15px;
    }
    #menu, #gameover, #pauseScreen {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      text-align: center;
      user-select: none;
      z-index: 10;
      background: rgba(0,0,0,0.5);
      border-radius: 10px;
      padding: 30px 40px;
      box-shadow: 0 0 20px rgba(0,0,0,0.8);
    }
    #menu h1, #gameover h1, #pauseScreen h1 {
      font-size: 48px;
      margin-bottom: 20px;
      text-shadow: 2px 2px 6px black;
    }
    button {
      cursor: pointer;
      font-family: 'Press Start 2P', cursive, monospace;
      font-size: 16px;
      background: #ffde59;
      border: none;
      border-radius: 8px;
      padding: 10px 20px;
      font-weight: bold;
      box-shadow: 0 3px #ccbb33;
      transition: background 0.3s ease;
      user-select: none;
    }
    button:hover {
      background: #fff97f;
    }
    #score, #highScore {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      color: white;
      font-size: 36px;
      text-shadow: 2px 2px 8px black;
      user-select: none;
      z-index: 5;
      font-weight: bold;
    }
    #highScore {
      top: 50px;
      font-size: 18px;
    }
    #muteBtn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(0,0,0,0.3);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 20px;
      color: white;
      box-shadow: 0 0 5px black;
      user-select: none;
      cursor: pointer;
      z-index: 10;
      transition: background 0.3s ease;
    }
    #muteBtn:hover {
      background: rgba(0,0,0,0.6);
    }
  </style>
</head>
<body>
  <div id="container">
    <canvas id="gameCanvas" width="400" height="600"></canvas>

    <div id="menu">
      <h1>Flappy Bird</h1>
      <button id="startBtn">Start Game</button>
      <p style="margin-top:15px; font-size: 14px;">Press Spacebar, Click or Tap to flap</p>
    </div>

    <div id="pauseScreen" style="display:none;">
      <h1>Paused</h1>
      <button id="resumeBtn">Resume</button>
    </div>

    <div id="gameover" style="display:none;">
      <h1>Game Over</h1>
      <p id="finalScore" style="margin: 15px 0; font-size: 18px;"></p>
      <button id="restartBtn">Restart</button>
    </div>

    <div id="score" style="display:none;">0</div>
    <div id="highScore" style="display:none;">High Score: 0</div>

    <div id="muteBtn" title="Toggle Mute">ðŸ”Š</div>
  </div>

  <script>
  (() => {
    // Canvas Setup
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const WIDTH = canvas.width;
    const HEIGHT = canvas.height;

    // DOM Elements
    const menu = document.getElementById('menu');
    const startBtn = document.getElementById('startBtn');
    const pauseScreen = document.getElementById('pauseScreen');
    const resumeBtn = document.getElementById('resumeBtn');
    const gameOverScreen = document.getElementById('gameover');
    const finalScoreText = document.getElementById('finalScore');
    const restartBtn = document.getElementById('restartBtn');
    const scoreDisplay = document.getElementById('score');
    const highScoreDisplay = document.getElementById('highScore');
    const muteBtn = document.getElementById('muteBtn');

    // Game variables
    let gameRunning = false;
    let animationId;
    let pipeInterval;
    let score = 0;
    let highScore = 0;
    let pipes = [];

    // Load high score from localStorage
    if(localStorage.getItem('flappyHighScore')) {
      highScore = parseInt(localStorage.getItem('flappyHighScore'));
      highScoreDisplay.textContent = `High Score: ${highScore}`;
    }

    // Load images
    const images = {};
    function loadImage(name, src) {
      return new Promise((res) => {
        const img = new Image();
        img.src = src;
        img.onload = () => {
          images[name] = img;
          res();
        };
      });
    }

    // Asset URLs
    // Bird frames for simple wing flap animation (3 frames)
    const birdFrames = [
      'https://i.imgur.com/srG0QqR.png', // frame 1 (wings up)
      'https://i.imgur.com/NRbMPR1.png', // frame 2 (wings mid)
      'https://i.imgur.com/JkQDyMw.png', // frame 3 (wings down)
    ];

    // Pipe images
    const pipeNorthUrl = 'https://i.imgur.com/EFqXTh2.png'; // pipe top (flipped)
    const pipeSouthUrl = 'https://i.imgur.com/11XDQYc.png'; // pipe bottom

    // Background and ground
    const bgUrl = 'https://i.imgur.com/oC1Bq9R.png';  // sky background
    const groundUrl = 'https://i.imgur.com/VOBPt8P.png'; // ground image

    // Sounds
    const sounds = {
      flap: new Audio('https://freesound.org/data/previews/341/341695_62436-lq.mp3'),
      score: new Audio('https://freesound.org/data/previews/186/186942_1505074-lq.mp3'),
      hit: new Audio('https://freesound.org/data/previews/256/256113_4486188-lq.mp3'),
      bgm: new Audio('https://cdn.pixabay.com/download/audio/2021/12/08/audio_81f524b83d.mp3?filename=upbeat-retro-video-game-loop-4968.mp3'),
    };

    sounds.bgm.loop = true;
    sounds.bgm.volume = 0.15;

    // Mute flag
    let muted = false;

    // Bird object
    const bird = {
      x: 80,
      y: HEIGHT / 2,
      width: 34,
      height: 24,
      frame: 0,
      frameCount: 0,
      frameDelay: 5, // frames between animation steps
      gravity: 0.6,
      lift: -10,
      velocity: 0,
      rotation: 0,
      flap() {
        this.velocity = this.lift;
        playSound('flap');
      },
      update() {
        this.velocity += this.gravity;
        this.velocity *= 0.9; // air resistance
        this.y += this.velocity;

        // Rotate bird depending on velocity
        this.rotation = Math.min(Math.max(this.velocity / 15, -0.5), 0.8);

        // Prevent bird from going out of canvas
        if (this.y + this.height / 2 >= HEIGHT - ground.height) {
          this.y = HEIGHT - ground.height - this.height / 2;
          this.velocity = 0;
          gameOver();
        }
        if (this.y - this.height / 2 <= 0) {
          this.y = this.height / 2;
          this.velocity = 0;
        }

        // Animate bird wings
        this.frameCount++;
        if (this.frameCount >= this.frameDelay) {
          this.frame = (this.frame + 1) % birdFrames.length;
          this.frameCount = 0;
        }
      },
      draw() {
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.rotate(this.rotation);
        // Draw bird image centered
        const img = images['bird' + this.frame];
        ctx.drawImage(img, -this.width/2, -this.height/2, this.width, this.height);
        ctx.restore();
      }
    };

    // Pipes
    const pipeWidth = 52; // pipe image width
    const pipeGap = 140;
    const pipeSpeed = 2.5;

    function createPipe() {
      const topHeight = Math.floor(Math.random() * (HEIGHT - pipeGap - ground.height - 100)) + 50;
      pipes.push({
        x: WIDTH,
        top: topHeight,
        bottom: HEIGHT - topHeight - pipeGap - ground.height,
        passed: false,
      });
    }

    function drawPipes() {
      pipes.forEach(pipe => {
        // Draw top pipe (flipped)
        ctx.save();
        ctx.translate(pipe.x + pipeWidth / 2, pipe.top);
        ctx.scale(1, -1);
        ctx.drawImage(images.pipeNorth, -pipeWidth / 2, 0, pipeWidth, pipe.top);
        ctx.restore();

        // Draw bottom pipe
        ctx.drawImage(images.pipeSouth, pipe.x, HEIGHT - pipe.bottom - ground.height, pipeWidth, pipe.bottom);
      });
    }

    function updatePipes() {
      pipes.forEach(pipe => {
        pipe.x -= pipeSpeed;
      });

      // Remove offscreen pipes
      if (pipes.length && pipes[0].x + pipeWidth < 0) {
        pipes.shift();
      }
    }

    // Ground object
    const ground = {
      x: 0,
      y: HEIGHT - 112, // ground height is 112px
      width: WIDTH,
      height: 112,
      speed: pipeSpeed,
      update() {
        this.x -= this.speed;
        if (this.x <= -this.width) this.x = 0;
      },
      draw() {
        ctx.drawImage(images.ground, this.x, this.y, this.width, this.height);
        ctx.drawImage(images.ground, this.x + this.width, this.y, this.width, this.height);
      }
    };

    // Background object
    const background = {
      draw() {
        ctx.drawImage(images.bg, 0, 0, WIDTH, HEIGHT);
      }
    };

    // Check collision between bird and pipes
    function checkCollision() {
      for (let pipe of pipes) {
        if (
          bird.x + bird.width / 2 > pipe.x &&
          bird.x - bird.width / 2 < pipe.x + pipeWidth
        ) {
          // Check vertical collision
          if (
            bird.y - bird.height / 2 < pipe.top ||
            bird.y + bird.height / 2 > HEIGHT - pipe.bottom - ground.height
          ) {
            gameOver();
            return true;
          }
        }
      }
      return false;
    }

    // Score handling
    function updateScore() {
      pipes.forEach(pipe => {
        if (!pipe.passed && pipe.x + pipeWidth < bird.x - bird.width / 2) {
          score++;
          pipe.passed = true;
          playSound('score');
          scoreDisplay.textContent = score;
        }
      });
    }

    // Play sound if not muted
    function playSound(name) {
      if (!muted && sounds[name]) {
        sounds[name].currentTime = 0;
        sounds[name].play();
      }
    }

    // Game loop
    function gameLoop() {
      ctx.clearRect(0, 0, WIDTH, HEIGHT);

      background.draw();

      bird.update();
      bird.draw();

      updatePipes();
      drawPipes();

      ground.update();
      ground.draw();

      if (!checkCollision()) {
        updateScore();
      }

      animationId = requestAnimationFrame(gameLoop);
    }

    // Start game
    function startGame() {
      menu.style.display = 'none';
      gameOverScreen.style.display = 'none';
      pauseScreen.style.display = 'none';
      scoreDisplay.style.display = 'block';
      highScoreDisplay.style.display = 'block';
      score = 0;
      scoreDisplay.textContent = score;
      pipes = [];
      bird.y = HEIGHT / 2;
      bird.velocity = 0;
      bird.frame = 0;
      bird.frameCount = 0;
      bird.rotation = 0;
      ground.x = 0;
      gameRunning = true;

      createPipe();
      createPipe();

      if(animationId) cancelAnimationFrame(animationId);
      gameLoop();

      if(pipeInterval) clearInterval(pipeInterval);
      pipeInterval = setInterval(() => {
        if (gameRunning) createPipe();
      }, 1700);

      if (!muted) sounds.bgm.play();
      updateMuteIcon();
    }

    // Game Over
    function gameOver() {
      if (!gameRunning) return;
      gameRunning = false;
      playSound('hit');
      cancelAnimationFrame(animationId);
      clearInterval(pipeInterval);
      scoreDisplay.style.display = 'none';
      finalScoreText.textContent = `Your Score: ${score}`;
      gameOverScreen.style.display = 'block';

      // Update high score
      if(score > highScore) {
        highScore = score;
        localStorage.setItem('flappyHighScore', highScore);
        highScoreDisplay.textContent = `High Score: ${highScore}`;
      }

      sounds.bgm.pause();
    }

    // Pause game
    function pauseGame() {
      if (!gameRunning) return;
      gameRunning = false;
      cancelAnimationFrame(animationId);
      clearInterval(pipeInterval);
      pauseScreen.style.display = 'block';
      sounds.bgm.pause();
    }

    // Resume game
    function resumeGame() {
      if (gameRunning) return;
      gameRunning = true;
      pauseScreen.style.display = 'none';
      gameLoop();

      pipeInterval = setInterval(() => {
        if (gameRunning) createPipe();
      }, 1700);

      if (!muted) sounds.bgm.play();
    }

    // Mute toggle
    function toggleMute() {
      muted = !muted;
      if(muted) {
        sounds.bgm.pause();
      } else if(gameRunning) {
        sounds.bgm.play();
      }
      updateMuteIcon();
    }

    function updateMuteIcon() {
      muteBtn.textContent = muted ? 'ðŸ”‡' : 'ðŸ”Š';
      muteBtn.title = muted ? 'Unmute' : 'Mute';
    }

    // Event Listeners
    startBtn.addEventListener('click', startGame);
    restartBtn.addEventListener('click', startGame);
    resumeBtn.addEventListener('click', resumeGame);

    // Flap controls
    document.addEventListener('keydown', e => {
      if(e.code === 'Space' || e.code === 'ArrowUp') {
        e.preventDefault();
        if(gameRunning) {
          bird.flap();
        } else if (menu.style.display !== 'none') {
          startGame();
        }
      }
      if(e.code === 'KeyP') {
        if(gameRunning) {
          pauseGame();
        } else if(pauseScreen.style.display !== 'none') {
          resumeGame();
        }
      }
    });

    // Click / tap to flap or start
    document.addEventListener('click', e => {
      // Prevent clicking buttons triggers flap
      if(e.target.tagName === 'BUTTON' || e.target === muteBtn) return;

      if(gameRunning) {
        bird.flap();
      } else if(menu.style.display !== 'none') {
        startGame();
      }
    });

    // Touch support
    document.addEventListener('touchstart', e => {
      e.preventDefault();
      if(gameRunning) {
        bird.flap();
      } else if(menu.style.display !== 'none') {
        startGame();
      }
    }, {passive:false});

    muteBtn.addEventListener('click', toggleMute);

    // Load assets and start

    async function loadAssets() {
      const promises = [];
      birdFrames.forEach((url, i) => promises.push(loadImage('bird' + i, url)));
      promises.push(loadImage('pipeNorth', pipeNorthUrl));
      promises.push(loadImage('pipeSouth', pipeSouthUrl));
      promises.push(loadImage('bg', bgUrl));
      promises.push(loadImage('ground', groundUrl));
      await Promise.all(promises);
    }

    loadAssets().then(() => {
      // Show menu after loading assets
      menu.style.display = 'block';
      scoreDisplay.style.display = 'none';
      highScoreDisplay.style.display = 'none';
      gameOverScreen.style.display = 'none';
      pauseScreen.style.display = 'none';
      updateMuteIcon();
    });
  })();
  </script>
</body>
</html>
