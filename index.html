<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flappy Deluxe</title>
<style>
:root{--accent:#ffd166;--muted:#64748b;--ui:#ffffffcc;}
*{box-sizing:border-box;font-family:'Segoe UI',sans-serif;margin:0;padding:0;}
body,html{height:100%;background:linear-gradient(#9be7ff,#bfeaff);overflow:hidden;}
.page{position:absolute;inset:0;display:flex;justify-content:center;align-items:center;flex-direction:column;opacity:0;pointer-events:none;transition:opacity 0.5s;}
.page.active{opacity:1;pointer-events:auto;}
button{padding:12px 24px;margin:8px;font-weight:700;border:none;border-radius:12px;cursor:pointer;transition:transform 0.2s;background:var(--accent);}
button:hover{transform:scale(1.05);}
.menu-title{font-size:2rem;margin-bottom:16px;color:#fff;text-shadow:0 3px 6px rgba(0,0,0,0.3);}
.card{background:var(--ui);padding:16px;border-radius:12px;display:flex;flex-direction:column;align-items:center;}
#skins .skin{width:64px;height:64px;margin:6px;border-radius:10px;cursor:pointer;display:flex;justify-content:center;align-items:center;border:2px solid transparent;}
#skins .skin.selected{outline:3px solid #fff;}
#themes .theme{width:80px;height:48px;border-radius:8px;margin:6px;cursor:pointer;display:flex;justify-content:center;align-items:center;font-weight:700;color:#111;}
#themes .theme.selected{outline:3px solid #fff;}
#gameCanvas{background:transparent;display:block;margin:auto;border-radius:12px;z-index:1;position:relative;}
#backBtn{position:absolute;top:12px;right:12px;padding:8px 12px;border-radius:8px;background:var(--ui);border:none;cursor:pointer;z-index:2;}
#scoreDisplay,#coinDisplay{position:absolute;top:12px;font-size:20px;font-weight:700;color:#fff;text-shadow:0 2px 4px #000;z-index:2;}
#scoreDisplay{left:12px;}
#coinDisplay{left:150px;}
</style>
</head>
<body>

<!-- MENU -->
<div id="menuPage" class="page active">
  <div class="menu-title">Flappy Deluxe</div>
  <div class="card">
    <button id="playBtn">Play</button>
    <button id="skinsBtn">Bird Skins</button>
    <button id="storeBtn">Store</button>
    <button id="leaderboardBtn">Leaderboard</button>
    <button id="settingsBtn">Settings</button>
  </div>
</div>

<!-- SKINS -->
<div id="skinsPage" class="page">
  <div class="menu-title">Choose Bird Skin</div>
  <div class="card" id="skins"></div>
  <button id="skinsBack">Back</button>
</div>

<!-- STORE -->
<div id="storePage" class="page">
  <div class="menu-title">Coin Store</div>
  <div class="card">
    <p>Coins: <span id="coinCount">0</span></p>
    <p>Challenges Completed: <span id="challengesDone">0</span></p>
    <button id="buyGold">Buy Gold Skin (50 coins)</button>
    <button id="buyGalaxy">Buy Galaxy Skin (150 coins)</button>
    <button id="buyDiamond">Buy Diamond Skin (300 coins)</button>
  </div>
  <button id="storeBack">Back</button>
</div>

<!-- LEADERBOARD -->
<div id="leaderboardPage" class="page">
  <div class="menu-title">Leaderboard</div>
  <div class="card" id="leaderboardList"></div>
  <button id="leaderboardBack">Back</button>
</div>

<!-- SETTINGS -->
<div id="settingsPage" class="page">
  <div class="menu-title">Settings</div>
  <div class="card">
    <div style="margin-bottom:8px;">Background Theme</div>
    <div id="themes"></div>
  </div>
  <button id="settingsBack">Back</button>
</div>

<!-- GAME -->
<div id="gamePage" class="page">
  <canvas id="gameCanvas" width="800" height="500"></canvas>
  <button id="backBtn">Main Menu</button>
  <div id="scoreDisplay">Score: 0</div>
  <div id="coinDisplay">ðŸ’° 0</div>
</div>

<script>
// --- Pages ---
const pages={menu:menuPage,skins:skinsPage,settings:settingsPage,game:gamePage,store:storePage,leaderboard:leaderboardPage};
function showPage(name){Object.values(pages).forEach(p=>p.classList.remove('active'));pages[name].classList.add('active');}

// --- Skins ---
const skinOptions=[
{id:'yellow',body:'#ffd166',beak:'#ff6b6b'},
{id:'red',body:'#ff7b9c',beak:'#ffd166'},
{id:'blue',body:'#5eead4',beak:'#ffd166'},
{id:'black',body:'#6b7280',beak:'#d1d5db'},
{id:'gold',body:'#ffda6a',beak:'#ffaa00',locked:true},
{id:'galaxy',body:'linear-gradient(to right,#6a11cb,#2575fc)',beak:'#fff',locked:true},
{id:'diamond',body:'#b9f2ff',beak:'#00f',locked:true}
];
let settings={skin:localStorage.getItem('flappy-skin')||'yellow',theme:localStorage.getItem('flappy-theme')||'day'};
let coins=Number(localStorage.getItem('flappy-coins')||0);
let challengesDone=Number(localStorage.getItem('flappy-challenges')||0);
const coinCount=document.getElementById('coinCount');
const challengesLabel=document.getElementById('challengesDone');
coinCount.textContent=coins;
challengesLabel.textContent=challengesDone;

const skinsContainer=document.getElementById('skins');
skinOptions.forEach(s=>{
  const b=document.createElement('div');
  b.className='skin';
  b.dataset.id=s.id;
  b.style.background=s.body;
  if(s.locked && !localStorage.getItem('unlocked-'+s.id)){b.style.filter='grayscale(1)';}
  b.addEventListener('click',()=>{
    if(s.locked&&!localStorage.getItem('unlocked-'+s.id)){alert('Locked! Buy in store.');return;}
    settings.skin=s.id;updateUI();localStorage.setItem('flappy-skin',s.id);
  });
  skinsContainer.appendChild(b);
});

// --- Themes ---
const themeOptions=[{id:'day',top:'#9be7ff',bottom:'#bfeaff'},{id:'sunset',top:'#ffb88c',bottom:'#ffecd2'},{id:'night',top:'#0f172a',bottom:'#071230'}];
const themesContainer=document.getElementById('themes');
themeOptions.forEach(t=>{
  const b=document.createElement('div');b.className='theme';b.dataset.id=t.id;
  b.style.background=`linear-gradient(180deg,${t.top},${t.bottom})`;
  b.textContent=t.id;
  b.addEventListener('click',()=>{settings.theme=t.id;updateUI();localStorage.setItem('flappy-theme',t.id);});
  themesContainer.appendChild(b);
});
function updateUI(){
  Array.from(skinsContainer.children).forEach(c=>c.classList.toggle('selected',c.dataset.id===settings.skin));
  Array.from(themesContainer.children).forEach(c=>c.classList.toggle('selected',c.dataset.id===settings.theme));
}
updateUI();

// --- Navigation ---
playBtn.onclick=()=>{showPage('game');startGame();};
skinsBtn.onclick=()=>{showPage('skins');updateUI();};
settingsBtn.onclick=()=>showPage('settings');
storeBtn.onclick=()=>showPage('store');
leaderboardBtn.onclick=()=>{showLeaderboard();showPage('leaderboard');};
skinsBack.onclick=settingsBack.onclick=storeBack.onclick=leaderboardBack.onclick=()=>showPage('menu');
backBtn.onclick=()=>{showPage('menu');running=false;};

// --- Buy skins ---
buyGold.onclick=()=>{buySkin('gold',50);}
buyGalaxy.onclick=()=>{buySkin('galaxy',150);}
buyDiamond.onclick=()=>{buySkin('diamond',300);}
function buySkin(id,cost){
  if(coins>=cost){coins-=cost;localStorage.setItem('unlocked-'+id,true);localStorage.setItem('flappy-coins',coins);coinCount.textContent=coins;alert(id+' skin unlocked!');updateUI();}
  else alert('Not enough coins!');
}

// --- Leaderboard ---
const leaderboardList=document.getElementById('leaderboardList');
const fakeScores=[{name:'Alice',score:75},{name:'Bob',score:60},{name:'Charlie',score:50},{name:'Dave',score:40},{name:'Eve',score:30}];
function showLeaderboard(){
  leaderboardList.innerHTML='';
  const best=Number(localStorage.getItem('flappy-best')||0);
  const all=[...fakeScores,{name:'You',score:best}].sort((a,b)=>b.score-a.score);
  all.forEach(p=>{
    const div=document.createElement('div');
    div.textContent=p.name+': '+p.score;
    leaderboardList.appendChild(div);
  });
}

// --- Game ---
const canvas=document.getElementById('gameCanvas');const ctx=canvas.getContext('2d');
let width=canvas.width,height=canvas.height;
let bird,pipes,frameCount,running=false,score=0,groundOffset=0;
let clouds=[];

// --- Initialize Clouds ---
for(let i=0;i<5;i++){clouds.push({x:Math.random()*width,y:Math.random()*150,width:60+Math.random()*60,height:30+Math.random()*20, speed:0.3+Math.random()*0.3});}

function resetGame(){bird={x:width/4,y:height/2,vy:0,r:16};pipes=[];frameCount=0;score=0;document.getElementById('scoreDisplay').textContent='Score: 0';}

function spawnPipe(){const gap=130;const top=60+Math.random()*(height-gap-120);pipes.push({x:width,top,gap,passed:false});}

// --- Flap & Physics ---
function flap(){bird.vy=-8;}
window.addEventListener('keydown',e=>{if(e.code==='Space')flap();});
canvas.addEventListener('mousedown',flap);
canvas.addEventListener('touchstart',e=>{e.preventDefault();flap();},{passive:false});

function startGame(){resetGame();running=true;requestAnimationFrame(gameLoop);}
function gameLoop(){if(!running)return;frameCount++;if(frameCount%90===0)spawnPipe();update();draw();requestAnimationFrame(gameLoop);}
function update(){
  const gravity=0.45;bird.vy+=gravity;if(bird.vy>10)bird.vy=10;bird.y+=bird.vy;
  pipes.forEach(p=>{p.x-=2.5;if(!p.passed&&p.x+60<bird.x){p.passed=true;score++;coins+=2;
      document.getElementById('scoreDisplay').textContent='Score: '+score;
      document.getElementById('coinDisplay').textContent='ðŸ’° '+coins;
      localStorage.setItem('flappy-coins',coins);
      checkChallenges();
    }
  });
  pipes=pipes.filter(p=>p.x>-60);
  if(bird.y+bird.r>height-24||bird.y-bird.r<0)gameOver();
  for(const p of pipes){if(bird.x+bird.r>p.x&&bird.x-bird.r<p.x+60){if(bird.y-bird.r<p.top||bird.y+bird.r>p.top+p.gap)gameOver();}}
  // update clouds
  clouds.forEach(c=>{c.x-=c.speed;if(c.x+c.width<0)c.x=width;});
  groundOffset=(groundOffset+2.5)%40;
}

function draw(){
  // background
  const th=themeOptions.find(t=>t.id===settings.theme);
  const g=ctx.createLinearGradient(0,0,0,height);g.addColorStop(0,th.top);g.addColorStop(1,th.bottom);ctx.fillStyle=g;ctx.fillRect(0,0,width,height);
  // clouds
  clouds.forEach(c=>{ctx.fillStyle='rgba(255,255,255,0.6)';ctx.beginPath();ctx.ellipse(c.x,c.y,c.width,c.height,0,0,Math.PI*2);ctx.fill();});
  // pipes
  pipes.forEach(p=>{
    const grd=ctx.createLinearGradient(p.x,0,p.x+60,0);grd.addColorStop(0,'#1e7c56');grd.addColorStop(1,'#3fc980');ctx.fillStyle=grd;
    ctx.fillRect(p.x,0,60,p.top);ctx.beginPath();ctx.moveTo(p.x,p.top);ctx.arc(p.x+30,p.top,30,Math.PI,0);ctx.fill();
    ctx.fillRect(p.x,p.top+p.gap,60,height-(p.top+p.gap)-24);ctx.beginPath();ctx.moveTo(p.x,p.top+p.gap);ctx.arc(p.x+30,p.top+p.gap,30,0,Math.PI);ctx.fill();
  });
  // ground
  ctx.fillStyle='#6fcf97';for(let i=-1;i<width/40+1;i++){ctx.fillRect(i*40-groundOffset,height-24,40,24);}
  // bird
  const skin=skinOptions.find(s=>s.id===settings.skin);
  const tilt=Math.max(-0.5,Math.min(0.5,bird.vy/8));
  ctx.save();ctx.translate(bird.x,bird.y);ctx.rotate(tilt);
  ctx.beginPath();ctx.ellipse(0,0,bird.r,bird.r*0.85,0,0,Math.PI*2);ctx.fillStyle=skin.body;ctx.fill();
  ctx.beginPath();ctx.arc(-4,-2,3,0,Math.PI*2);ctx.fillStyle='#111';ctx.fill();
  ctx.beginPath();ctx.moveTo(bird.r-2,0);ctx.lineTo(bird.r+12,-5);ctx.lineTo(bird.r+12,6);ctx.closePath();ctx.fillStyle=skin.beak;ctx.fill();
  ctx.restore();
}
function gameOver(){running=false;const best=Number(localStorage.getItem('flappy-best')||0);if(score>best){localStorage.setItem('flappy-best',score);}alert('Game Over! Score: '+score);showPage('menu');}

// --- Challenges ---
function checkChallenges(){
  if(score===10&&!localStorage.getItem('challenge10')){localStorage.setItem('challenge10',true);coins+=20;challengesDone++;alert('Challenge complete: Pass 10 pipes! +20 coins');}
  if(score===25&&!localStorage.getItem('challenge25')){localStorage.setItem('challenge25',true);coins+=40;challengesDone++;alert('Challenge complete: Pass 25 pipes! +40 coins');}
  if(score===50&&!localStorage.getItem('challenge50')){localStorage.setItem('challenge50',true);coins+=100;challengesDone++;alert('Challenge complete: Pass 50 pipes! +100 coins');}
  if(score===100&&!localStorage.getItem('challenge100')){localStorage.setItem('challenge100',true);coins+=300;challengesDone++;alert('Challenge complete: Pass 100 pipes! +300 coins');}
  localStorage.setItem('flappy-coins',coins);
  localStorage.setItem('flappy-challenges',challengesDone);
  coinCount.textContent=coins;
  challengesLabel.textContent=challengesDone;
}
</script>
</body>
</html>
